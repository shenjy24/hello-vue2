"use strict";(self["webpackChunkjackal_vue2_new"]=self["webpackChunkjackal_vue2_new"]||[]).push([[981],{3701:function(e,n,t){t.r(n),t.d(n,{default:function(){return g}});t(41539),t(82526),t(41817),t(32165),t(78783),t(33948),t(21703),t(21249),t(38862),t(39714),t(57327);var r=t(23302),o=t(43723),a=t(28554),i=function(){};function u(e){var n="XDomainRequest"in window,t=n?new window.XDomainRequest:new XMLHttpRequest;if(t.open(e.type||"GET",e.url,!0),t.success=e.success||i,t.fail=e.fail||i,t.withCredentials=e.withCredentials,n?(t.onload=e.success||i,t.onerror=e.fail||i,t.onprogress=i):t.onreadystatechange=function(){if(4===t.readyState){var n=t.status;n>=200?e.success&&e.success(t.responseText):e.fail&&e.fail("Request failed, status: "+n+", responseText: "+t.responseText)}},"POST"===e.type){if(e.headers&&!n)for(var r in e.headers)t.setRequestHeader(r,e.headers[r]);t.send(e.data)}else t.send();return t}var s,c=function(e,n,t,r){function o(e){return e instanceof t?e:new t((function(n){n(e)}))}return new(t||(t=Promise))((function(t,a){function i(e){try{s(r.next(e))}catch(n){a(n)}}function u(e){try{s(r["throw"](e))}catch(n){a(n)}}function s(e){e.done?t(e.value):o(e.value).then(i,u)}s((r=r.apply(e,n||[])).next())}))},l=function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(e){return function(n){return s([e,n])}}function s(a){if(t)throw new TypeError("Generator is already executing.");while(i)try{if(t=1,r&&(o=2&a[0]?r["return"]:a[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(o=i.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(e,i)}catch(u){a=[6,u],r=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},f=function(e,n,t,r,o){return c(void 0,void 0,void 0,(function(){return l(this,(function(a){return[2,new Promise((function(a,i){u({url:e,type:r||"GET",data:n,withCredentials:!!t,headers:o,success:function(e){a(e)},fail:function(e){i(new Error(e||"Request failed"))}})}))]}))}))},p=t(21322),d=t(65962),h=function(){return h=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t],n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},h.apply(this,arguments)},w=function(e,n,t,r){function o(e){return e instanceof t?e:new t((function(n){n(e)}))}return new(t||(t=Promise))((function(t,a){function i(e){try{s(r.next(e))}catch(n){a(n)}}function u(e){try{s(r["throw"](e))}catch(n){a(n)}}function s(e){e.done?t(e.value):o(e.value).then(i,u)}s((r=r.apply(e,n||[])).next())}))},y=function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(e){return function(n){return s([e,n])}}function s(a){if(t)throw new TypeError("Generator is already executing.");while(i)try{if(t=1,r&&(o=2&a[0]?r["return"]:a[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(o=i.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(e,i)}catch(u){a=[6,u],r=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function v(e,n){var t;return w(this,void 0,void 0,(function(){var o,i,u,c,l;return y(this,(function(p){switch(p.label){case 0:return[4,s.getLogsByReportName(e)];case 1:return o=p.sent(),o.length>0?(i=s.logReportNameParser(e).pageIndex,u=o.map((function(e){return encodeURIComponent(e.logString)})),c=s.logReportNameParser(e),l="function"===typeof n.xhrOptsFormatter?n.xhrOptsFormatter(u,c.pageIndex+1,c.logDay):{},[4,f(l.reportUrl||n.reportUrl||a.Z.get("reportUrl"),l.data||JSON.stringify({client:"Web",webSource:""+(n.webSource||""),deviceId:n.deviceId,environment:""+(n.environment||""),customInfo:""+(n.customInfo||""),logPageNo:c.pageIndex+1,fileDate:c.logDay,logArray:o.map((function(e){return encodeURIComponent(e.logString)})).toString()}),(t=l.withCredentials,null!==t&&void 0!==t&&t),"POST",l.headers||{"Content-Type":"application/json",Accept:"application/json,text/javascript"}).then((function(e){var n,t;if("function"===typeof l.responseDealer){var o=l.responseDealer(e);if(o.resultMsg===r.$.REPORT_LOG_SUCC)return i;throw new Error(o.desc)}var a=void 0;try{a=JSON.parse(e)}catch(u){throw new Error("Try to parse response failed, responseText: "+e)}if(200===(null===(n=a)||void 0===n?void 0:n.code))return i;throw new Error("Server error, code: "+(null===(t=a)||void 0===t?void 0:t.code))}))]):[3,3];case 2:return[2,p.sent()];case 3:return[2,Promise.resolve(null)]}}))}))}function g(e){return w(this,void 0,void 0,(function(){var n=this;return y(this,(function(t){switch(t.label){case 0:if(o.Z.idbIsSupported())return[3,1];throw new Error(r.$.DB_NOT_SUPPORT);case 1:return s||(s=new o.Z(a.Z.get("dbName"))),[4,(0,d.j)((function(){return w(n,void 0,void 0,(function(){var n,t,a,i,u,c,l,f,d,w;return y(this,(function(y){switch(y.label){case 0:return[4,s.getLogDaysInfo(e.fromDayString,e.toDayString)];case 1:n=y.sent(),t=n.reduce((function(e,n){var t;return h((t={},t[n[o.X]]=n.reportPagesInfo?n.reportPagesInfo.pageSizes.map((function(e,t){return s.logReportNameFormatter(n[o.X],t)})):[],t),e)}),{}),a={},i=(0,p.nO)(e.fromDayString),u=(0,p.nO)(e.toDayString),c=+i,y.label=2;case 2:if(!(c<=+u))return[3,14];if(l=(0,p.Pf)(new Date(c)),!(t[l]&&t[l].length>0))return[3,12];y.label=3;case 3:return y.trys.push([3,10,,11]),[4,Promise.all(t[l].map((function(n){return v(n,e)})))];case 4:f=y.sent(),a[l]={msg:r.$.REPORT_LOG_SUCC},y.label=5;case 5:return y.trys.push([5,8,,9]),d=f.filter((function(e){return null!==e})),d.length>0&&e.incrementalReport?[4,s.incrementalDelete(l,d)]:[3,7];case 6:y.sent(),y.label=7;case 7:return[3,9];case 8:return y.sent(),[3,9];case 9:return[3,11];case 10:return w=y.sent(),a[l]={msg:r.$.REPORT_LOG_FAIL,desc:w.message||w.stack||JSON.stringify(w)},[3,11];case 11:return[3,13];case 12:a[l]={msg:r.$.NO_LOG},y.label=13;case 13:return c+=p.Q2,[3,2];case 14:return[2,a]}}))}))}))];case 2:return[2,t.sent()]}}))}))}}}]);
//# sourceMappingURL=report_log-legacy.18e0d1fc.js.map